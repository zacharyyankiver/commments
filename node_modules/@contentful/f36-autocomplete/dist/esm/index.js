import i, { useState, useCallback } from 'react';
import { cx, css } from 'emotion';
import { useCombobox } from 'downshift';
import { mergeRefs, getMenuItemStyles } from '@contentful/f36-core';
import { IconButton } from '@contentful/f36-button';
import { TextInput } from '@contentful/f36-forms';
import { ChevronDownIcon, CloseIcon } from '@contentful/f36-icons';
import { Skeleton } from '@contentful/f36-skeleton';
import { Popover } from '@contentful/f36-popover';
import { Subheading, SectionHeading, Text } from '@contentful/f36-typography';
import { getStringMatch } from '@contentful/f36-utils';
import a from '@contentful/f36-tokens';

var Ve=Object.defineProperty,Ge=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var Q=(t,o,n)=>o in t?Ve(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,m=(t,o)=>{for(var n in o||(o={}))Y.call(o,n)&&Q(t,n,o[n]);if(w)for(var n of w(o))Z.call(o,n)&&Q(t,n,o[n]);return t},u=(t,o)=>Ge(t,ke(o));var ee=(t,o)=>{var n={};for(var s in t)Y.call(t,s)&&o.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&w)for(var s of w(t))o.indexOf(s)<0&&Z.call(t,s)&&(n[s]=t[s]);return n};var H=t=>({autocomplete:css({position:"relative",width:"100%"}),combobox:css({position:"relative"}),inputField:css({paddingRight:a.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:a.spacing2Xs,minHeight:"calc(100% - 2px)"}),content:css({overflow:"auto",maxHeight:`${t}px`}),list:css({listStyle:"none",padding:`${a.spacingXs} ${a.spacing2Xs}`,margin:0}),groupTitle:css({padding:`${a.spacingXs} ${a.spacingM}`,lineHeight:a.lineHeightM}),noMatchesTitle:css({color:a.gray500,margin:`${a.spacingM} 0 ${a.spacingM} 0`}),item:({isActive:o=!1,isDisabled:n=!1})=>cx(getMenuItemStyles({isActive:o,isDisabled:n})),highlighted:css({backgroundColor:a.gray100}),hidden:css({display:"none"})});var E=t=>{let{items:o,elementStartIndex:n,highlightedIndex:s,getItemProps:g,renderItem:v,inputValue:C,listMaxHeight:O=180}=t,h=H(O);return i.createElement("ul",{className:h.list,"data-test-id":"cf-autocomplete-list"},o.map((I,V)=>{let f=n+V,l=g({item:I,index:f});return i.createElement(Text,u(m({},l),{as:"li",key:f,className:cx([h.item({}),s===f&&h.highlighted]),"data-test-id":`cf-autocomplete-list-item-${f}`}),v?v(I,C):typeof I=="string"?i.createElement(te,{item:I,inputValue:C}):I)}))};E.displayName="AutocompleteItems";function te({item:t,inputValue:o}){let{before:n,match:s,after:g}=getStringMatch(t,o);return i.createElement(i.Fragment,null,n,i.createElement("b",null,s),g)}te.displayName="HighlightedItem";function je(t,o){let {isOpen:n,onClose:s,onOpen:g,id:v,className:C,clearAfterSelect:O=!1,textOnAfterSelect:h=O?"clear":"replace",closeAfterSelect:I=!0,defaultValue:V="",selectedItem:f,items:l,inputValue:X,onInputValueChange:P,onSelectItem:ie,onFocus:G,onBlur:k,renderItem:U,icon:se=i.createElement(ChevronDownIcon,{variant:"muted"}),itemToString:re=e=>e,isInvalid:le,isDisabled:W,isRequired:ae,isReadOnly:pe,showEmptyList:me,noMatchesMessage:ue="No matches found",placeholder:ce="Search",inputRef:de,toggleRef:ge,listRef:Ie,listWidth:he="auto",listMaxHeight:fe=180,isGrouped:S=!1,isLoading:M=!1,usePortal:ye=!1,testId:Te="cf-autocomplete",popoverTestId:be="cf-autocomplete-container",showClearButton:R,aria:q={clearSelectionIconLabel:"Clear",showListIconLabel:"Show list"}}=t,p=H(fe),[xe,ve]=useState(V),b=typeof X=="undefined"?xe:X,x=useCallback(e=>{ve(e),P==null||P(e);},[P]),Ce=useCallback(e=>{let r=e.target.value;x(r);},[x]),Pe=N(S)?l.reduce((e,r)=>[...e,...r.options],[]):l,Se=N(S)?l.every(e=>e.options.length===0):l.length===0,{getComboboxProps:Me,getInputProps:Le,getItemProps:K,getMenuProps:Ae,getToggleButtonProps:we,highlightedIndex:z,isOpen:He,openMenu:Ee,toggleMenu:Ne}=useCombobox({isOpen:n,onIsOpenChange:({isOpen:e})=>{e?g==null||g():s==null||s();},stateReducer:(e,{type:r,changes:y})=>{switch(r){case useCombobox.stateChangeTypes.InputBlur:return u(m({},y),{inputValue:e.inputValue});case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:return I?y:u(m({},y),{isOpen:e.isOpen});default:return y}},items:Pe,selectedItem:f,inputValue:b,itemToString:re,onInputValueChange:({type:e,inputValue:r})=>{switch(e){case useCombobox.stateChangeTypes.InputChange:return;case useCombobox.stateChangeTypes.ItemClick:case useCombobox.stateChangeTypes.InputKeyDownEnter:{if(h==="clear"){x("");return}if(h==="preserve")return}}x(r);},onStateChange:({type:e,selectedItem:r})=>{switch(e){case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:r&&ie(r);break;}}}),J=Le(),L=ee(J,["aria-labelledby","id"]),Oe=Me(),j=we(),A=Ae(),B=0,D=R!=null?R:b;return i.createElement("div",{"data-test-id":Te,className:cx(p.autocomplete,C),ref:o},i.createElement(Popover,{usePortal:ye,isOpen:He,isFullWidth:he==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:A.id},i.createElement(Popover.Trigger,null,i.createElement("div",u(m({},Oe),{className:p.combobox}),i.createElement(TextInput,u(m({className:p.inputField},L),{onFocus:e=>{G==null||G(e),Ee();},onBlur:e=>{k==null||k(e),L.onBlur(e);},id:v,isInvalid:le,isDisabled:W,isRequired:ae,isReadOnly:pe,ref:mergeRefs(L.ref,de),testId:"cf-autocomplete-input",placeholder:ce,onChange:e=>{L.onChange(e),Ce(e);}})),i.createElement(IconButton,u(m({},j),{ref:mergeRefs(j.ref,ge),"aria-label":D?q.clearSelectionIconLabel:q.showListIconLabel,className:p.toggleButton,variant:"transparent",icon:D?i.createElement(CloseIcon,{variant:"muted"}):se,onClick:()=>{D?x(""):Ne();},isDisabled:W,size:"small"})))),l.length>0||b.length>0||me?i.createElement(Popover.Content,u(m({},A),{ref:mergeRefs(A.ref,Ie),className:p.content,testId:be}),M&&[...Array(3)].map((e,r)=>i.createElement("div",{key:r,className:cx(p.item({isDisabled:!0}))},i.createElement(Je,null))),!M&&Se&&i.createElement("div",{className:p.item({})},i.createElement(Subheading,{className:p.noMatchesTitle},ue)),!M&&N(S)&&l.map((e,r)=>{if(e.options.length<1)return;let y=i.createElement("div",{key:r},i.createElement(SectionHeading,{key:r,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:p.groupTitle},e.groupTitle),i.createElement(E,{items:e.options,highlightedIndex:z,getItemProps:K,renderItem:U,inputValue:b,elementStartIndex:B}));return B+=e.options.length,y}),!M&&!N(S)&&l.length>0&&i.createElement(E,{items:l,elementStartIndex:B,highlightedIndex:z,getItemProps:K,renderItem:U,inputValue:b})):i.createElement("div",u(m({},A),{className:cx(p.hidden)}))))}var Je=()=>i.createElement(Skeleton.Container,{svgHeight:16},i.createElement(Skeleton.BodyText,{numberOfLines:1}));function N(t,o){return t}var Qe=i.forwardRef(je);

export { Qe as Autocomplete };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map