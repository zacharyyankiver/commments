'use strict';

var i = require('react');
var emotion = require('emotion');
var downshift = require('downshift');
var f36Core = require('@contentful/f36-core');
var f36Button = require('@contentful/f36-button');
var f36Forms = require('@contentful/f36-forms');
var f36Icons = require('@contentful/f36-icons');
var f36Skeleton = require('@contentful/f36-skeleton');
var f36Popover = require('@contentful/f36-popover');
var f36Typography = require('@contentful/f36-typography');
var f36Utils = require('@contentful/f36-utils');
var a = require('@contentful/f36-tokens');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var i__default = /*#__PURE__*/_interopDefault(i);
var a__default = /*#__PURE__*/_interopDefault(a);

var Ve=Object.defineProperty,Ge=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var Q=(t,o,n)=>o in t?Ve(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,m=(t,o)=>{for(var n in o||(o={}))Y.call(o,n)&&Q(t,n,o[n]);if(w)for(var n of w(o))Z.call(o,n)&&Q(t,n,o[n]);return t},u=(t,o)=>Ge(t,ke(o));var ee=(t,o)=>{var n={};for(var s in t)Y.call(t,s)&&o.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&w)for(var s of w(t))o.indexOf(s)<0&&Z.call(t,s)&&(n[s]=t[s]);return n};var H=t=>({autocomplete:emotion.css({position:"relative",width:"100%"}),combobox:emotion.css({position:"relative"}),inputField:emotion.css({paddingRight:a__default.default.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:emotion.css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:a__default.default.spacing2Xs,minHeight:"calc(100% - 2px)"}),content:emotion.css({overflow:"auto",maxHeight:`${t}px`}),list:emotion.css({listStyle:"none",padding:`${a__default.default.spacingXs} ${a__default.default.spacing2Xs}`,margin:0}),groupTitle:emotion.css({padding:`${a__default.default.spacingXs} ${a__default.default.spacingM}`,lineHeight:a__default.default.lineHeightM}),noMatchesTitle:emotion.css({color:a__default.default.gray500,margin:`${a__default.default.spacingM} 0 ${a__default.default.spacingM} 0`}),item:({isActive:o=!1,isDisabled:n=!1})=>emotion.cx(f36Core.getMenuItemStyles({isActive:o,isDisabled:n})),highlighted:emotion.css({backgroundColor:a__default.default.gray100}),hidden:emotion.css({display:"none"})});var E=t=>{let{items:o,elementStartIndex:n,highlightedIndex:s,getItemProps:g,renderItem:v,inputValue:C,listMaxHeight:O=180}=t,h=H(O);return i__default.default.createElement("ul",{className:h.list,"data-test-id":"cf-autocomplete-list"},o.map((I,V)=>{let f=n+V,l=g({item:I,index:f});return i__default.default.createElement(f36Typography.Text,u(m({},l),{as:"li",key:f,className:emotion.cx([h.item({}),s===f&&h.highlighted]),"data-test-id":`cf-autocomplete-list-item-${f}`}),v?v(I,C):typeof I=="string"?i__default.default.createElement(te,{item:I,inputValue:C}):I)}))};E.displayName="AutocompleteItems";function te({item:t,inputValue:o}){let{before:n,match:s,after:g}=f36Utils.getStringMatch(t,o);return i__default.default.createElement(i__default.default.Fragment,null,n,i__default.default.createElement("b",null,s),g)}te.displayName="HighlightedItem";function je(t,o){let {isOpen:n,onClose:s,onOpen:g,id:v,className:C,clearAfterSelect:O=!1,textOnAfterSelect:h=O?"clear":"replace",closeAfterSelect:I=!0,defaultValue:V="",selectedItem:f,items:l,inputValue:X,onInputValueChange:P,onSelectItem:ie,onFocus:G,onBlur:k,renderItem:U,icon:se=i__default.default.createElement(f36Icons.ChevronDownIcon,{variant:"muted"}),itemToString:re=e=>e,isInvalid:le,isDisabled:W,isRequired:ae,isReadOnly:pe,showEmptyList:me,noMatchesMessage:ue="No matches found",placeholder:ce="Search",inputRef:de,toggleRef:ge,listRef:Ie,listWidth:he="auto",listMaxHeight:fe=180,isGrouped:S=!1,isLoading:M=!1,usePortal:ye=!1,testId:Te="cf-autocomplete",popoverTestId:be="cf-autocomplete-container",showClearButton:R,aria:q={clearSelectionIconLabel:"Clear",showListIconLabel:"Show list"}}=t,p=H(fe),[xe,ve]=i.useState(V),b=typeof X=="undefined"?xe:X,x=i.useCallback(e=>{ve(e),P==null||P(e);},[P]),Ce=i.useCallback(e=>{let r=e.target.value;x(r);},[x]),Pe=N(S)?l.reduce((e,r)=>[...e,...r.options],[]):l,Se=N(S)?l.every(e=>e.options.length===0):l.length===0,{getComboboxProps:Me,getInputProps:Le,getItemProps:K,getMenuProps:Ae,getToggleButtonProps:we,highlightedIndex:z,isOpen:He,openMenu:Ee,toggleMenu:Ne}=downshift.useCombobox({isOpen:n,onIsOpenChange:({isOpen:e})=>{e?g==null||g():s==null||s();},stateReducer:(e,{type:r,changes:y})=>{switch(r){case downshift.useCombobox.stateChangeTypes.InputBlur:return u(m({},y),{inputValue:e.inputValue});case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:return I?y:u(m({},y),{isOpen:e.isOpen});default:return y}},items:Pe,selectedItem:f,inputValue:b,itemToString:re,onInputValueChange:({type:e,inputValue:r})=>{switch(e){case downshift.useCombobox.stateChangeTypes.InputChange:return;case downshift.useCombobox.stateChangeTypes.ItemClick:case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:{if(h==="clear"){x("");return}if(h==="preserve")return}}x(r);},onStateChange:({type:e,selectedItem:r})=>{switch(e){case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:r&&ie(r);break;}}}),J=Le(),L=ee(J,["aria-labelledby","id"]),Oe=Me(),j=we(),A=Ae(),B=0,D=R!=null?R:b;return i__default.default.createElement("div",{"data-test-id":Te,className:emotion.cx(p.autocomplete,C),ref:o},i__default.default.createElement(f36Popover.Popover,{usePortal:ye,isOpen:He,isFullWidth:he==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:A.id},i__default.default.createElement(f36Popover.Popover.Trigger,null,i__default.default.createElement("div",u(m({},Oe),{className:p.combobox}),i__default.default.createElement(f36Forms.TextInput,u(m({className:p.inputField},L),{onFocus:e=>{G==null||G(e),Ee();},onBlur:e=>{k==null||k(e),L.onBlur(e);},id:v,isInvalid:le,isDisabled:W,isRequired:ae,isReadOnly:pe,ref:f36Core.mergeRefs(L.ref,de),testId:"cf-autocomplete-input",placeholder:ce,onChange:e=>{L.onChange(e),Ce(e);}})),i__default.default.createElement(f36Button.IconButton,u(m({},j),{ref:f36Core.mergeRefs(j.ref,ge),"aria-label":D?q.clearSelectionIconLabel:q.showListIconLabel,className:p.toggleButton,variant:"transparent",icon:D?i__default.default.createElement(f36Icons.CloseIcon,{variant:"muted"}):se,onClick:()=>{D?x(""):Ne();},isDisabled:W,size:"small"})))),l.length>0||b.length>0||me?i__default.default.createElement(f36Popover.Popover.Content,u(m({},A),{ref:f36Core.mergeRefs(A.ref,Ie),className:p.content,testId:be}),M&&[...Array(3)].map((e,r)=>i__default.default.createElement("div",{key:r,className:emotion.cx(p.item({isDisabled:!0}))},i__default.default.createElement(Je,null))),!M&&Se&&i__default.default.createElement("div",{className:p.item({})},i__default.default.createElement(f36Typography.Subheading,{className:p.noMatchesTitle},ue)),!M&&N(S)&&l.map((e,r)=>{if(e.options.length<1)return;let y=i__default.default.createElement("div",{key:r},i__default.default.createElement(f36Typography.SectionHeading,{key:r,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:p.groupTitle},e.groupTitle),i__default.default.createElement(E,{items:e.options,highlightedIndex:z,getItemProps:K,renderItem:U,inputValue:b,elementStartIndex:B}));return B+=e.options.length,y}),!M&&!N(S)&&l.length>0&&i__default.default.createElement(E,{items:l,elementStartIndex:B,highlightedIndex:z,getItemProps:K,renderItem:U,inputValue:b})):i__default.default.createElement("div",u(m({},A),{className:emotion.cx(p.hidden)}))))}var Je=()=>i__default.default.createElement(f36Skeleton.Skeleton.Container,{svgHeight:16},i__default.default.createElement(f36Skeleton.Skeleton.BodyText,{numberOfLines:1}));function N(t,o){return t}var Qe=i__default.default.forwardRef(je);

exports.Autocomplete = Qe;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map