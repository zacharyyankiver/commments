'use strict';

var L = require('react');
var f36Core = require('@contentful/f36-core');
var reactPopper = require('react-popper');
var emotion = require('emotion');
var f36Utils = require('@contentful/f36-utils');
var x = require('@contentful/f36-tokens');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var L__default = /*#__PURE__*/_interopDefault(L);
var x__default = /*#__PURE__*/_interopDefault(x);

var te=Object.defineProperty,re=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var F=(e,t,o)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,a=(e,t)=>{for(var o in t||(t={}))k.call(t,o)&&F(e,o,t[o]);if(y)for(var o of y(t))A.call(t,o)&&F(e,o,t[o]);return e},m=(e,t)=>re(e,ne(t));var N=(e,t)=>{var o={};for(var r in e)k.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&y)for(var r of y(e))t.indexOf(r)<0&&A.call(e,r)&&(o[r]=e[r]);return o};var K=(e,t,o)=>new Promise((r,f)=>{var v=s=>{try{l(o.next(s));}catch(n){f(n);}},P=s=>{try{l(o.throw(s));}catch(n){f(n);}},l=s=>s.done?r(s.value):Promise.resolve(s.value).then(v,P);l((o=o.apply(e,t)).next());});var U=L__default.default.createContext(void 0),h=()=>{let e=L__default.default.useContext(U);if(e===void 0)throw new Error("usePopoverContext must be used within a PopoverContextProvider");return e},$=U.Provider;function V(e){let{children:t,isOpen:o,placement:r="bottom-start",isFullWidth:f=!1,isAutoalignmentEnabled:v=!0,usePortal:P=!0,closeOnBlur:l=!0,closeOnEsc:s=!0,onClose:n,autoFocus:C=!0,id:E,offset:T=[1,4],renderOnlyWhenOpen:g=!0}=e,[i,X]=L.useState(null),[c,Y]=L.useState(null),{attributes:S,update:M,styles:I}=reactPopper.usePopper(i,c,{placement:r,modifiers:[{name:"offset",options:{offset:T}},m(a({},ue),{enabled:f}),{name:"preventOverflow",enabled:v,options:{mainAxis:!0}},{name:"flip",enabled:v}]});L.useEffect(()=>{o&&C&&c&&c.focus({preventScroll:!0});},[o,c]),L.useEffect(()=>{(()=>K(this,null,function*(){o&&M&&(yield M());}))();},[o,M]);let Z=f36Core.useId(void 0,"popover-content"),w=E||Z,B=L.useCallback(()=>{n==null||n(),setTimeout(()=>i==null?void 0:i.focus({preventScroll:!0}),0);},[n,i]),O=L.useRef(!1),_=L.useMemo(()=>({isOpen:!!o,usePortal:P,renderOnlyWhenOpen:g,getTriggerProps:(p={},H=null)=>({onMouseDown:u=>{var d;O.current=!0,(d=p.onMouseDown)==null||d.call(p,u);},onMouseUp:u=>{var d;O.current=!1,(d=p.onMouseUp)==null||d.call(p,u);},ref:f36Core.mergeRefs(X,H),"aria-expanded":!!o,"aria-controls":w}),getPopoverProps:(p={},H=null)=>m(a({},S.popper),{style:a(a({},p.style||{}),I.popper),ref:f36Core.mergeRefs(Y,H),id:w,onBlur:u=>{if(p.onBlur&&p.onBlur(u),!l)return;let d=document.activeElement,b=u.relatedTarget||d,ee=c===b||(c==null?void 0:c.contains(b)),oe=i===b||(i==null?void 0:i.contains(b))||O.current;ee||oe||n==null||n();},onKeyDown:u=>{p.onKeyDown&&p.onKeyDown(u),s&&u.key==="Escape"&&B();}})}),[o,g,S,I,P,w,s,l,c,i,B,n]);return L__default.default.createElement($,{value:_},t)}var ue={name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:e})=>{e.styles.popper.width=`${e.rects.reference.width}px`;},effect:({state:e})=>()=>{let t=e.elements.reference;e.elements.popper.style.width=`${t.offsetWidth}px`;}};var J=e=>({container:emotion.css({display:e?"initial":"none",background:x__default.default.colorWhite,border:0,borderRadius:x__default.default.borderRadiusMedium,boxShadow:x__default.default.boxShadowDefault,zIndex:x__default.default.zIndexDropdown,"&:focus":{boxShadow:x__default.default.glowPrimary,outline:"none"},"&:focus:not(:focus-visible)":{boxShadow:x__default.default.boxShadowDefault}})});var fe=(e,t)=>{let g=e,{children:o,className:r,testId:f="cf-ui-popover-content",role:v="dialog"}=g,P=N(g,["children","className","testId","role"]),{isOpen:l,renderOnlyWhenOpen:s,getPopoverProps:n,usePortal:C}=h(),E=J(l),T=L__default.default.createElement("div",m(a(a({},P),n(P,t)),{className:emotion.cx(E.container,r),"data-test-id":f,tabIndex:-1,role:v,"data-position-absolute":!0}),o);return s&&!l?null:C?L__default.default.createElement(f36Utils.Portal,null,T):T},R=L__default.default.forwardRef(fe);var D=e=>{var r;let t=L__default.default.Children.only(e.children),{getTriggerProps:o}=h();return L__default.default.cloneElement(t,m(a({},o(t.props,t.ref)),{"aria-haspopup":(r=t.props["aria-haspopup"])!=null?r:"dialog"}))};var W=V;W.Content=R;W.Trigger=D;

exports.Popover = W;
exports.PopoverContent = R;
exports.PopoverTrigger = D;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map