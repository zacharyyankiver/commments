"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.selectOrganization = selectOrganization;
exports.getOrganizationById = getOrganizationById;
const ora_1 = __importDefault(require("ora"));
const utils_1 = require("./utils");
const constants_1 = require("./constants");
async function fetchOrganizations(client) {
    try {
        const orgs = await client.getOrganizations();
        return orgs.items.map((org) => ({
            name: org.name,
            value: org.sys.id,
        }));
    }
    catch (err) {
        return (0, utils_1.throwError)(err, 'Could not fetch your organizations. Make sure you provided a valid access token.');
    }
}
async function selectOrganization(client) {
    const orgSpinner = (0, ora_1.default)('Fetching your organizations...').start();
    try {
        const organizations = await fetchOrganizations(client);
        orgSpinner.stop();
        return await (0, utils_1.selectFromList)(organizations, 'Select an organization:', constants_1.ORG_ID_ENV_KEY);
    }
    finally {
        orgSpinner.stop();
    }
}
async function getOrganizationById(client, orgId) {
    try {
        const org = await client.getOrganization(orgId);
        return {
            name: org.name,
            value: org.sys.id,
        };
    }
    catch (err) {
        return (0, utils_1.throwError)(err, 'Could not fetch your organization. Make sure you provided a valid access token.');
    }
}
